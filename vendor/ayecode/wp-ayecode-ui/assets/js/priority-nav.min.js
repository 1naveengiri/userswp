(function(root,factory){if(typeof define==="function"&&define.amd){define("priorityNav",factory(root))}else if(typeof exports==="object"){module.exports=factory(root)}else{root.priorityNav=factory(root)}})(window||this,function(root){"use strict";var priorityNav={};var breaks=[];var supports=!!document.querySelector&&!!root.addEventListener;var settings={};var instance=0;var count=0;var mainNavWrapper,totalWidth,restWidth,mainNav,navDropdown,navDropdownToggle,dropDownWidth,toggleWrapper;var viewportWidth=0;var defaults={initClass:"js-priorityNav",mainNavWrapper:"nav",mainNav:"ul",navDropdownClassName:"nav__dropdown",navDropdownToggleClassName:"nav__dropdown-toggle",navDropdownLabel:"more",navDropdownBreakpointLabel:"menu",breakPoint:500,throttleDelay:50,offsetPixels:0,count:true,moved:function(){},movedBack:function(){}};var forEach=function(collection,callback,scope){if(Object.prototype.toString.call(collection)==="[object Object]"){for(var prop in collection){if(Object.prototype.hasOwnProperty.call(collection,prop)){callback.call(scope,collection[prop],prop,collection)}}}else{for(var i=0,len=collection.length;i<len;i++){callback.call(scope,collection[i],i,collection)}}};var getClosest=function(elem,selector){var firstChar=selector.charAt(0);for(;elem&&elem!==document;elem=elem.parentNode){if(firstChar==="."){if(elem.classList.contains(selector.substr(1))){return elem}}else if(firstChar==="#"){if(elem.id===selector.substr(1)){return elem}}else if(firstChar==="["){if(elem.hasAttribute(selector.substr(1,selector.length-2))){return elem}}}return false};var extend=function(defaults,options){var extended={};forEach(defaults,function(value,prop){extended[prop]=defaults[prop]});forEach(options,function(value,prop){extended[prop]=options[prop]});return extended};function debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)func.apply(context,args)};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)func.apply(context,args)}}var toggleClass=function(el,className){if(el.classList){el.classList.toggle(className)}else{var classes=el.className.split(" ");var existingIndex=classes.indexOf(className);if(existingIndex>=0)classes.splice(existingIndex,1);else classes.push(className);el.className=classes.join(" ")}};var prepareHtml=function(_this,settings){toggleWrapper=document.createElement("span");navDropdown=document.createElement("ul");navDropdownToggle=document.createElement("button");navDropdownToggle.innerHTML=settings.navDropdownLabel;navDropdownToggle.setAttribute("aria-controls","menu");navDropdownToggle.setAttribute("type","button");navDropdown.setAttribute("aria-hidden","true");if(_this.querySelector(mainNav).parentNode!==_this){console.warn("mainNav is not a direct child of mainNavWrapper, double check please");return}_this.insertAfter(toggleWrapper,_this.querySelector(mainNav));toggleWrapper.appendChild(navDropdownToggle);toggleWrapper.appendChild(navDropdown);navDropdown.classList.add(settings.navDropdownClassName);navDropdown.classList.add("priority-nav__dropdown");navDropdownToggle.classList.add(settings.navDropdownToggleClassName);navDropdownToggle.classList.add("priority-nav__dropdown-toggle");navDropdownToggle.setAttribute("type","button");toggleWrapper.classList.add(settings.navDropdownClassName+"-wrapper");toggleWrapper.classList.add("priority-nav__wrapper");_this.classList.add("priority-nav")};var getElementContentWidth=function(element){var styles=window.getComputedStyle(element);var padding=parseFloat(styles.paddingLeft)+parseFloat(styles.paddingRight);return element.clientWidth-padding};var viewportSize=function(){var doc=document,w=window;var docEl=doc.compatMode&&doc.compatMode==="CSS1Compat"?doc.documentElement:doc.body;var width=docEl.clientWidth;var height=docEl.clientHeight;if(w.innerWidth&&width>w.innerWidth){width=w.innerWidth;height=w.innerHeight}return{width:width,height:height}};var calculateWidths=function(_this){totalWidth=getElementContentWidth(_this);if(_this.querySelector(navDropdown).parentNode===_this){dropDownWidth=_this.querySelector(navDropdown).offsetWidth}else{dropDownWidth=0}restWidth=getChildrenWidth(_this)+settings.offsetPixels;viewportWidth=viewportSize().width};priorityNav.doesItFit=function(_this){var delay=_this.getAttribute("instance")===0?delay:settings.throttleDelay;instance++;debounce(function(){var identifier=_this.getAttribute("instance");calculateWidths(_this);while(totalWidth<=restWidth&&_this.querySelector(mainNav).children.length>0||viewportWidth<settings.breakPoint&&_this.querySelector(mainNav).children.length>0){priorityNav.toDropdown(_this,identifier);calculateWidths(_this,identifier);if(viewportWidth<settings.breakPoint)updateLabel(_this,identifier,settings.navDropdownBreakpointLabel)}while(totalWidth>=breaks[identifier][breaks[identifier].length-1]&&viewportWidth>settings.breakPoint){priorityNav.toMenu(_this,identifier);if(viewportWidth>settings.breakPoint)updateLabel(_this,identifier,settings.navDropdownLabel)}if(breaks[identifier].length<1){_this.querySelector(navDropdown).classList.remove("show");updateLabel(_this,identifier,settings.navDropdownLabel)}if(_this.querySelector(mainNav).children.length<1){_this.classList.add("is-empty");updateLabel(_this,identifier,settings.navDropdownBreakpointLabel)}else{_this.classList.remove("is-empty")}showToggle(_this,identifier)},delay)()};var showToggle=function(_this,identifier){if(breaks[identifier].length<1){_this.querySelector(navDropdownToggle).classList.add("priority-nav-is-hidden");_this.querySelector(navDropdownToggle).classList.remove("priority-nav-is-visible");_this.classList.remove("priority-nav-has-dropdown");_this.querySelector(".priority-nav__wrapper").setAttribute("aria-haspopup","false")}else{_this.querySelector(navDropdownToggle).classList.add("priority-nav-is-visible");_this.querySelector(navDropdownToggle).classList.remove("priority-nav-is-hidden");_this.classList.add("priority-nav-has-dropdown");_this.querySelector(".priority-nav__wrapper").setAttribute("aria-haspopup","true")}};var updateCount=function(_this,identifier){_this.querySelector(navDropdownToggle).setAttribute("priorityNav-count",breaks[identifier].length)};var updateLabel=function(_this,identifier,label){_this.querySelector(navDropdownToggle).innerHTML=label};priorityNav.toDropdown=function(_this,identifier){if(_this.querySelector(navDropdown).firstChild&&_this.querySelector(mainNav).children.length>0){_this.querySelector(navDropdown).insertBefore(_this.querySelector(mainNav).lastElementChild,_this.querySelector(navDropdown).firstChild)}else if(_this.querySelector(mainNav).children.length>0){_this.querySelector(navDropdown).appendChild(_this.querySelector(mainNav).lastElementChild)}breaks[identifier].push(restWidth);showToggle(_this,identifier);if(_this.querySelector(mainNav).children.length>0&&settings.count){updateCount(_this,identifier)}settings.moved()};priorityNav.toMenu=function(_this,identifier){if(_this.querySelector(navDropdown).children.length>0)_this.querySelector(mainNav).appendChild(_this.querySelector(navDropdown).firstElementChild);breaks[identifier].pop();showToggle(_this,identifier);if(_this.querySelector(mainNav).children.length>0&&settings.count){updateCount(_this,identifier)}settings.movedBack()};var getChildrenWidth=function(e){var children=e.childNodes;var sum=0;for(var i=0;i<children.length;i++){if(children[i].nodeType!==3){if(!isNaN(children[i].offsetWidth)){sum+=children[i].offsetWidth}}}return sum};var listeners=function(_this,settings){if(window.attachEvent){window.attachEvent("onresize",function(){if(priorityNav.doesItFit)priorityNav.doesItFit(_this)})}else if(window.addEventListener){window.addEventListener("resize",function(){if(priorityNav.doesItFit)priorityNav.doesItFit(_this)},true)}_this.querySelector(navDropdownToggle).addEventListener("click",function(){toggleClass(_this.querySelector(navDropdown),"show");toggleClass(this,"is-open");toggleClass(_this,"is-open");if(-1!==_this.className.indexOf("is-open")){_this.querySelector(navDropdown).setAttribute("aria-hidden","false")}else{_this.querySelector(navDropdown).setAttribute("aria-hidden","true");_this.querySelector(navDropdown).blur()}});document.addEventListener("click",function(event){if(!getClosest(event.target,"."+settings.navDropdownClassName)&&event.target!==_this.querySelector(navDropdownToggle)){_this.querySelector(navDropdown).classList.remove("show");_this.querySelector(navDropdownToggle).classList.remove("is-open");_this.classList.remove("is-open")}});document.onkeydown=function(evt){evt=evt||window.event;if(evt.keyCode===27){document.querySelector(navDropdown).classList.remove("show");document.querySelector(navDropdownToggle).classList.remove("is-open");mainNavWrapper.classList.remove("is-open")}}};Element.prototype.remove=function(){this.parentElement.removeChild(this)};NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var i=0,len=this.length;i<len;i++){if(this[i]&&this[i].parentElement){this[i].parentElement.removeChild(this[i])}}};priorityNav.destroy=function(){if(!settings)return;document.documentElement.classList.remove(settings.initClass);toggleWrapper.remove();settings=null;delete priorityNav.init;delete priorityNav.doesItFit};if(supports&&typeof Node!=="undefined"){Node.prototype.insertAfter=function(n,r){this.insertBefore(n,r.nextSibling)}}var checkForSymbols=function(string){var firstChar=string.charAt(0);if(firstChar==="."||firstChar==="#"){return false}else{return true}};priorityNav.init=function(options){settings=extend(defaults,options||{});if(!supports&&typeof Node==="undefined"){console.warn("This browser doesn't support priorityNav");return}if(!checkForSymbols(settings.navDropdownClassName)||!checkForSymbols(settings.navDropdownToggleClassName)){console.warn("No symbols allowed in navDropdownClassName & navDropdownToggleClassName. These are not selectors.");return}var elements=document.querySelectorAll(settings.mainNavWrapper);forEach(elements,function(_this){breaks[count]=[];_this.setAttribute("instance",count++);mainNavWrapper=_this;if(!mainNavWrapper){console.warn("couldn't find the specified mainNavWrapper element");return}mainNav=settings.mainNav;if(!_this.querySelector(mainNav)){console.warn("couldn't find the specified mainNav element");return}prepareHtml(_this,settings);navDropdown="."+settings.navDropdownClassName;if(!_this.querySelector(navDropdown)){console.warn("couldn't find the specified navDropdown element");return}navDropdownToggle="."+settings.navDropdownToggleClassName;if(!_this.querySelector(navDropdownToggle)){console.warn("couldn't find the specified navDropdownToggle element");return}listeners(_this,settings);priorityNav.doesItFit(_this)});instance++;document.documentElement.classList.add(settings.initClass)};return priorityNav});